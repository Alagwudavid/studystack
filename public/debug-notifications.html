<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Debug</title>
</head>

<body>
    <h1>Notification Debug</h1>
    <div id="results"></div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';

        async function testNotifications() {
            const results = document.getElementById('results');

            // Check if token exists
            let token = localStorage.getItem('auth_token');
            results.innerHTML += `<p><strong>Token from localStorage:</strong> ${token ? token.substring(0, 50) + '...' : 'null'}</p>`;

            if (!token) {
                results.innerHTML += '<p style="color: orange;">No token found in localStorage. Using test token...</p>';
                // Use our test token
                token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyLCJlbWFpbCI6Im5ld3VzZXJAZXhhbXBsZS5jb20iLCJpYXQiOjE3NTQwNzkzMTQsImV4cCI6MTc1NDA4MjkxNCwiaXNzIjoiYml0cm9vdC1hcGkifQ.5voy1rRmxfkzyYBLrAGcSjFhrX1HeWllGGtY4KIJhrI';
                // Store it for testing
                localStorage.setItem('auth_token', token);
                results.innerHTML += '<p style="color: green;">✅ Test token stored in localStorage</p>';
            }

            try {
                // Test API call
                const response = await fetch(`${API_BASE_URL}/notifications?limit=10&offset=0`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    credentials: 'include'
                });

                results.innerHTML += `<p><strong>Response status:</strong> ${response.status}</p>`;

                const data = await response.json();
                results.innerHTML += `<p><strong>Response data:</strong></p><pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto;">${JSON.stringify(data, null, 2)}</pre>`;

                if (data.success) {
                    results.innerHTML += `<p style="color: green;">✅ Notifications loaded: ${data.data.notifications.length} notifications, ${data.data.unread_count} unread</p>`;

                    // Show notifications
                    if (data.data.notifications.length > 0) {
                        results.innerHTML += '<h3>Notifications:</h3>';
                        data.data.notifications.forEach(notif => {
                            results.innerHTML += `<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                                <strong>${notif.title}</strong><br>
                                <span style="color: #666;">${notif.message}</span><br>
                                <small>Type: ${notif.type}, Status: ${notif.status}, Created: ${notif.created_at}</small>
                            </div>`;
                        });
                    }
                } else {
                    results.innerHTML += `<p style="color: red;">❌ API error: ${data.message}</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p style="color: red;">❌ Network error: ${error.message}</p>`;
            }
        }

        // Run test when page loads
        testNotifications();
    </script>
</body>

</html>